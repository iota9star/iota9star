name: GitHub-Profile-Automation

on:
  schedule:
    - cron: "0 8 * * *"
  workflow_dispatch:

jobs:
  automated-tasks:
    runs-on: ubuntu-latest
    name: run-automated-tasks
    steps:
      - uses: actions/checkout@v4

      - name: Generate 3D Profile Contrib
        uses: yoshi389111/github-profile-3d-contrib@v0.9.1
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
          USERNAME: ${{ github.repository_owner }}
          MAX_REPOS: 999

      - name: Run Claude Code Action
        uses: anthropics/claude-code-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          show_full_output: false
          prompt: |
            You are a creative GitHub profile designer. Generate a fresh, engaging README.md from the profile.md data.

            ## Data Collection
            1. Read profile.md for personal info (content before <!-- REPOS -->)
            2. Extract repo links from <!-- REPOS --> section
            3. Use gh CLI to fetch project details (stars, description) - query ONE BY ONE to avoid rate limits
            4. Sort by popularity (stars descending)

            ## Design Guidelines (be creative!)

            **Core Requirements:**
            - Use GitHub Cards: <a href="repo-url"><img src="https://gh-card.dev/repos/owner/repo.svg"></a>
            - Include a quote from: curl -s https://v1.hitokoto.cn/
            - Write in English
            - Replace entire README.md content

            **You Decide (experiment with different styles):**
            - Layout: single/multi-column grid, list with cards, sections by category, or your invention
            - Project info: cards only, or add descriptions, tech stack tags, or quick stats
            - Personal intro: short & punchy, detailed narrative, or creative tagline
            - Visual style: minimal, colorful, emoji-rich, or professional clean
            - Sections: what to include and in what order (skills, projects, stats, contact...)
            - Quote placement: intro, between sections, footer, or creative spot
            - Formatting: use HTML tables, CSS grids, flexbox, or standard Markdown

            **Themes to try (vary each run):**
            - Minimalist tech showcase
            - Story-driven developer journey
            - Product-focused portfolio
            - Stats-heavy analytics view
            - Creative & personality-driven
            - Or surprise us!

            Goal: Showcase the projects professionally while making it visually interesting. Feel free to break conventions and try something new each time.

            Output the final result to README.md (replace existing content).
          anthropic_api_key: ${{ secrets.CLAUDE_API_KEY }}
        env:
          ANTHROPIC_AUTH_TOKEN: ${{ secrets.CLAUDE_API_KEY }}
          ANTHROPIC_BASE_URL: ${{ secrets.CLAUDE_API_BASE_URL }}
          ANTHROPIC_DEFAULT_HAIKU_MODEL: ${{ secrets.CLAUDE_MODEL }}
          ANTHROPIC_DEFAULT_SONNET_MODEL: ${{ secrets.CLAUDE_MODEL }}
          ANTHROPIC_DEFAULT_OPUS_MODEL: ${{ secrets.CLAUDE_MODEL }}

      - name: Commit & Push All Changes
        run: |
          git config user.name github-actions
          git config user.email github-actions@github
          git add -A .
          git diff --staged --quiet || git commit -m "Run automated tasks: p3d & claude-code"
          git push
